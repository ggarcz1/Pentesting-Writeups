**[https://tryhackme.com/r/room/yueiua](https://tryhackme.com/r/room/yueiua)** 

** 
  
Firstly, we conduct a Nmap scan of the IP address:

`nmap -sVC 10.10.143.26`
![[Pasted image 20240918143655.png]]

From the scan results, we can see that ports 22 (SSH) and 80 (http) are running. Browsing to the website, we see that there are a few pages to click around on:

![[Pasted image 20240918143756.png]]

Next, we utilize `gobuster` to enumerate any webpages and/or directories that were missed through manual enumeration.
`gobuster dir -u [http://10.10.143.26](http://10.10.143.26)  -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,sh,txt,cgi,html,css,js,py`

![[Pasted image 20240918144128.png]]

A page of interest is not only because it was not initially noted but due to a 301 (Redirect) status is `/assets` 
![[Pasted image 20240918144225.png]]
There does not appear to be anything on this page/directory, therefore further enumeration is necessary. 
`gobuster dir -u [http://10.10.143.26/assets](http://10.10.143.26/assets)  -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,sh,txt,cgi,html,css,js,py`

![[Pasted image 20240918144201.png]]

From here, there are two additional items of interest; `/images` and `/index.php`

Forbidden on the `/images` path

![[Pasted image 20240918144251.png]]


`look at and insert the apache/2.4.41 vulns here`

And a blank page at `/asssets/index.php`
![[Pasted image 20240918144320.png]]

However, there may be a parameter associated with the `/index.php`

Bruteforce:
`ffuf -w /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt -u http://10.10.143.26/assets/index.php?FUZZ={random_data} -fs 0`


![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXc-FkhF5EDuxekbG3xFov0IUpbNvuSpx2-WJWGl92-8Kit88vkX7wOGkMGR2Hl83V-AqeNeDAZ81pfGJ0qA8eu9JQMBKtyBwEdu9SlN2VBkkRq6fH4ymIe_H_gGBKMpz_h1hS7lj1BYaE94G31LKUj2AA?key=K1Up4Xv8oRiLBZSnUbYW0g)

It appears there is a parameter called `cmd`.  If we add a command here, such as http://{IP}/assets/index.php?cmd=ls, we receive data back encoded with base64.

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXe0tMFkXAa9a6Sr7iuI1bUTR27zVtlVGpQR-EAJWTOz--lcscmnmG28q5Ff0ScKXq0NYR-Ezl7m4XY7u7x-lKVUvJtcFYTFzV5ZPH4h-qP5dUrNUf8jTQwhymhC1TI7q8ugDpAaRK_psjZPgj_0Ewk0AUo?key=K1Up4Xv8oRiLBZSnUbYW0g)

Decoding the data:
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXe9iWIYG3VpL2D0srPyKJadJyxkRDRjfDw3PaLO2LYSaFHX_B7lRaNTuee0e4c5dI2xE-OEDWpNhBWdJWsw9PlUeAhw3y8_g5nivl6Mkgb7vAG2jKTOpsEAcOAZAT0zWpXGHLsjP92gLavsaeGKvzchX18?key=K1Up4Xv8oRiLBZSnUbYW0g)

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXde8JdP6gndJY9ybAtnukNVL9UPQ1oTre_7U4JZM_rrYluH1aKs5H1Q7d0vC4xAjNrURk3okRrDtWgA-RmUdEdILvdcVe25Kkb2vr3VGEVurOWKA6Yse6AHsQt8yRvGgLRANfbuI0ORO_xuLtrqzbjdBZY?key=K1Up4Xv8oRiLBZSnUbYW0g)

It appears all the application is now doing is executing commands and returning it in Base64.  Therefore, we can utilize the `cmd=?` parameter for a reverse shell.  However, it needs to be URL encoded since we are placing it directly into the URL. 

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdv6wBFLaID3g14YgCAjpcsu0Xmefwjlk6u5r56bPShA5t1nIUFYM11z52HvLeE81whVx6xmE9ur5sLy10e8dnw126OSpe00_6VNAfhCxSVznneUmFZ5ErqHEdH86lJC05oxcvL_XpkYqKoVZUIDp20KrM?key=K1Up4Xv8oRiLBZSnUbYW0g)

From here, a unstable reverse shell is created.  
I was unable to directly access and read the user.txt (located in `home/users/deku/Desktop/user.txt`) and through some manual enumeration, I found a directory called `Hidden_content`.  
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXeN31vkpWHt0tug21hccSLzxmweqamwy4TUy24nTi0AwoWX5mVfYWik7yFYaJ48wtrT-61s0nGIl2keVBBGGh_ObiBFOVQEehwZyhtpcLQ8UoWAEBICxuB_ZySXADaBVVNzdq3r68Tf6St-RxIIdFoC_oY?key=K1Up4Xv8oRiLBZSnUbYW0g)

Convert this base64 in the command line:
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXf_0iwP8u2fLFzQEQU5cfKDACH0S7TViN2uojZmnMaluBf56svCFyRku6QScaaEyc5Xaw32Uy3b3pp0XwGt4E566Gnk8wumXZR0n6AbaEt6x5dJZT2LDDV1txGPDbttuR6ksMIHzjld2ylQNKcr2eeTzks?key=K1Up4Xv8oRiLBZSnUbYW0g)

These appear to be possible password for a user.  Let's try the following:
`deku:AllmightForEver!!

These credentials do not work for SSH, so the password/credentials must be for another item.

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXc1ZubkVLHcQqfa2fbZhlVb7aG08BelONHG-N-v4t_IIABJy_zdMa4eCzt-SDAA2A_WW9YGVJ0rIvZtIM_7v2EkkTAOBN2zxjPDHI1hsbkOFSkf2Mick59ngh2cv_tlsHpx6qBzQETHwpna_82H4yX8YFI?key=K1Up4Xv8oRiLBZSnUbYW0g)

Back to enumeration.  Recalling the directories discovered in the `gobuster` portion of the CTF, there was a path `assets/images`
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdQ73dl2psE2vORk-baQj3UzSBnpHTnJaWGk5VSyMs8XjupCHhq37wUccVDK8RO-ogoDeqDAu-Tsr4G8618ZX32oh3kvncYlFqxsM5FG0kr1VU9YzL_RXLK4iJLX_4dbYRJ1lcBXqnuFZ6BYDy6ePxBk3I?key=K1Up4Xv8oRiLBZSnUbYW0g)
There are two .jpg files. First, I browsed to them in the browser and noted that the first .jpg, "oneforall.jpg", appears to be corrupted.

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcMbFlpF97OnTZa_sZqoTIXegONG5PJ1XNTpz7fWNbaul2jQMx-V4pINafc8poqGdcdhBp3DtBPqXa570mUV3nzszNUoMRuZsgtc16j7Z9a72W4Jpbqk_VDY7kr49UlCQmQ099bzU2iaU6L-5S4N6KRHLk?key=K1Up4Xv8oRiLBZSnUbYW0g)

 Using the `curl` command to pull them down and view, 
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXflHj2PFpnax45cNrIGc1oUEmmea14Akt6hqqSH8RRwdXFX_6A3i7vMg0v9aovpt_4vb7zxl-smY2_Qr4_L-KjPSfXOIPmrqwsDbFWpp_l7BZNtVouN9iilww6lB-GgqLWA6nyQi3JjL6c1SZ9f5L8UJg?key=K1Up4Xv8oRiLBZSnUbYW0g)

  
`exiftool`, `file`, and `head` commands told me that the file titled "oneforall.jpg" was corrupted and needed to have it's header updated to be displayed properly.
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXf-iBsDyHK7bckEJyjws00z28ymMVq9ABMeM3ydrpQmZYWygJ8uh96Yui2gnShhWiqvzn38yGKhD6g96qPK5ZfEi7vDAvg74x_7DCfedTwW2gcqVTr3EmvNXnm33VXyozD4eCJxV3ZV6KPCN38_ZT4gMY8?key=K1Up4Xv8oRiLBZSnUbYW0g)

  
From [https://en.wikipedia.org/wiki/List_of_file_signatures](https://en.wikipedia.org/wiki/List_of_file_signatures) 

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdm8mOH1ksaRh-OKjWSVWwv8DxUximTucbxdrfPOpuSSliewSIt1yudaeiE1EqPuGLk3lTfM1Hj55HxKAOVcDf0d51fLf94-702IlnVQGCgsRrNwucKxGEwNK5WKhCxjghxYiHSPAxuV1O3t3vHLlmUnH0?key=K1Up4Xv8oRiLBZSnUbYW0g)

Next, I utilized `hexeditor` with the `-b` flag to insert new bytes into the data of the file.   

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXcYqNT2FV8Qx8zqxH5V_m4CG6bgp7ceR9cjgaHUyyHdzdBt2xujfo4RUkPoHPudkQrN30fSUA3OQOxFXSzn_Xk_KJbt9oJB3SAXHwU3-ayfo9dtSPVGbPwt1rEIecE_mR444BcA0uQAXYoWlqlxTw9LDg?key=K1Up4Xv8oRiLBZSnUbYW0g)

CTRL+A to add bytes

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXev6xw3Z2N5GxezGKOMnk9eVI4DmPUmfDLXTpEyiM_33-rDartW32Pia4B8x6NQHIg3nteppYpCuWJQ4ipZiPSHVMN7GfY8H873SvNeeARiWArWir7I6MxWyRkrlcc4maf7MQWdugDHo2Kzmccf455CBiM?key=K1Up4Xv8oRiLBZSnUbYW0g)

After completion, we have a proper .jpg image:

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXeFdGeHS9mJ6ezHBrp4IznISZpxgLg2qOm30RXJAyFJn9Yb1UeontAXXiJQbGR_rpOB-jTMBacKQ6zV64H9jyi2ewH4cJt3ccrjCJTXzJ4QBjvCj4bTE1sFP9_OyvjLfm0-VJd_FetfdOHUCnytNlU12bI?key=K1Up4Xv8oRiLBZSnUbYW0g)



![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXejqhU0jAHK8b-Ys8y0fjB9phyiirKwzzfCnUDZype7n5cPAOOzqHPvZyQjutOWIF9pOBuCJ-2G0eqU8VVRp-8eUcPy2hMQ34DqdOgJqLbZpBNvZtICiMy_gAlBVaN9kUhJkiPWGzKGw9iIaGX_S07GpX0?key=K1Up4Xv8oRiLBZSnUbYW0g)


Noting the complexity of this ".jpg", I then decided to use `steghide` to attempt data extraction with the password found in the `Hidden_Content` directory.  
`AllmightForEver!!!`

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXc8NZFGy5fIYmT3CkRBlAYU8JxbO8MjG3GgBmx_xWt4xgkPkdT0lbvnfuf3n2YBE9-2y0LbX2vDli5ieGDuCOSenNWqV0H69iShstGvpejWFuQmCd6l3whfHsm0YgMJxi2H8DeeLAxECZnBPCG3lTg88OU?key=K1Up4Xv8oRiLBZSnUbYW0g)

Now it appears that we have found valid credentials for something.
`deku:One?For?All_!!one1/A`

So, let's try these credentials with SSH:
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXfSr8--9MfafACcuj-sr7gIeaKwnfryCXxkc4bEprjaB8QH5Pfkvx4NTtj-DbjgB1_NxbMBzxz9Rjgvq4qRyAlAwmWpUn9wAvjAnRObGnlWSpl9e9pjpUvtuYbtK5kOjXp6qYwc9pbFl5T50oi1ICBSzg?key=K1Up4Xv8oRiLBZSnUbYW0g)

Now, we are the user `deku` and may access the file we seek.
![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXdspKM07mRboGZwugFj2OVOxq-0b1eOjoiLI18UoMVfRDZsTnb_ArwDiFRFC5Ji2sTzqCM51iYPo3xdZ_mdyby2aUtKYQEctTWYSpPUfRfmcYKbgC1BQfNcI-UY93ny5ATrCWqV3GIrCmOYdihuH-XvRIA?key=K1Up4Xv8oRiLBZSnUbYW0g)

`THM{W3lC0m3_D3kU_1A_0n3f0rAll??}`

Now that access to the internal system is authenticated, lets check out what `LinPEAS` suggests we do: 

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXeDN9hcAIsODGuKYwo8WzdIghDrxnA0qpNUPGKNc4Vz3X9704zP6QLz_QHnVPET5jb8ue4vYCDoD1pUl9isBcNbBXXfsaQRPN7y-31nHb9s3H44Ifz4-a6LQEcv5bnfCBL_yU3Sk-lgyDC24bqw81H9sMY?key=K1Up4Xv8oRiLBZSnUbYW0g)

![](https://lh7-rt.googleusercontent.com/docsz/AD_4nXfTmYV-85DStp4CtPJYYknnpR_F6KyUH4t-SScm32YHDsTOLpPmsZflXsofYCLh4IK7j_eubDE24R6NyhIYE-_DA3XlZWIyYO3p1sP6-rTHDrHvpHthMdKfvlAbtqdMW9S5Scy913tS134pmadfcAsm9x4?key=K1Up4Xv8oRiLBZSnUbYW0g)

And here are our current permissions:
![[Pasted image 20240918095158.png]]
From the lengthy results, there are a few files of interest, 
- `/usr/bin/gettext.sh
- `/usr/bin/rescan-scsi-bus.sh
- `opt/NewComponent/feedback.sh`

Reviewing these files, the only one that suggests a valid vector of attach is `feedback.sh`
![[Pasted image 20240918094831.png]]

On the line `eval "echo $feedback"`, this is a poor programming security item as we can input a command to be executed, with a few considerations. We cannot input the following characters:
- \\\\
- )
- (
- |
- &
- ;
- ?
- !
- /

However, we can input `>` to update a file, such as the sudoer's file.  From `sudo -l` before, we know that we are able to run feedback.sh
![[Pasted image 20240918095158.png]]

So, we can 
- add ssh key 
- add current user to the /etc/sudoers file

I elected to add the user to the sudoers file
`deku ALL= NOPASSWD: ALL

Original code: `echo {command} 
On user input: `echo deku ALL= NOPASSWD: ALL >> /etc/sudoers
![[Pasted image 20240918142442.png]]

Here we can see that the entry is now within the suoders file, and we have the root flag. 
![[Pasted image 20240918143236.png]]


THM{Y0U_4r3_7h3_NUm83r_1_H3r0}

**